<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>登录</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.9.14/css/layui.css" rel="stylesheet">
    <style>
        .center-text {
            text-align: center;
        }

        .login_font {
            font-size: 3em;
            color: black;
            padding-bottom: 1em;
            margin: 0;
            text-align: center;
        }
    </style>

</head>
<body>
<div class="layui-container" style="height: 90vh">

    <div class="layui-row" style="height: 90vh">
        <div class="layui-col-xs12 layui-col-sm8" style="padding: 1% 1%;">
            <div class="layui-panel">
                <div style="padding: 32px ">
                    <!--登录界面-->
                    <form class="layui-form" lay-filter="form-login">
                        <div class="demo-login-container">
                            <div class="login_font">登录/添加新账号</div>
                            <div class="layui-form-item" style="display: none" id="form-div-name">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-username"></i>
                                    </div>
                                    <input type="text" name="name" value="" lay-verify=""
                                           placeholder="姓 名" lay-reqtext="请填写姓名" autocomplete="off"
                                           class="layui-input" lay-affix="clear">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-tabs"></i>
                                    </div>
                                    <input type="text" name="student_id" value="" lay-verify="required|number"
                                           placeholder="学 号" lay-reqtext="请填写学号" autocomplete="off"
                                           class="layui-input" lay-affix="clear">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-password"></i>
                                    </div>
                                    <input type="password" name="password" value="" lay-verify="required"
                                           placeholder="密   码" lay-reqtext="请填写密码" autocomplete="off"
                                           class="layui-input" lay-affix="eye">
                                </div>
                            </div>
                            <div class="layui-form-item" id="form-div-comment" style="display: none">
                                <div class="layui-input-wrap">
                                    <div class="layui-input-prefix">
                                        <i class="layui-icon layui-icon-reply-fill"></i>
                                    </div>
                                    <input type="text" name="comment" value="" lay-verify=""
                                           placeholder="备 注" lay-reqtext="按需填写备注" autocomplete="off"
                                           class="layui-input" lay-affix="clear">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-col-xs9 layui-col-sm9">
                                    <!--<button class="layui-btn  layui-btn-fluid" lay-submit lay-filter="demo-login">-->
                                    <button class="layui-btn  layui-btn-fluid" id="login_button">
                                        登录
                                    </button>
                                </div>

                                <div class="layui-col-xs3 layui-col-sm3">
                                    <div style="display: flex; justify-content: center; align-items: center; ">
                                        <input type="checkbox" name="save_account" title="记住密码|直接登录"
                                               lay-skin="switch" lay-filter="save_account_switch">
                                    </div>
                                </div>

                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm4" style="padding: 1% 1%; height: 90vh">
            <div class="center-text">
                <h2>已有账号</h2>
            </div>
            <div style="overflow: auto;height: 90vh">

                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
                <div class="layui-panel">
                    <div style="padding: 32px">面板任意内容</div>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="//unpkg.com/layui@2.9.14/dist/layui.js"></script>
<script>
    layui.use(function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;

        $('#login_button').on('click', function () {
            form.submit('form-login', function (data) {
                const field = data.field; // 获取表单全部字段值
                const student_id = field.student_id;
                const password = field.password;

                const login_result = pywebview.api.login(student_id, password);
                login_result.then(function (result) {
                    console.log(result['success'])
                    if (result['success']) {
                        // 登录成功
                        if (field.save_account) {
                            // 保存账号密码
                            const name = field.name
                            const comment = field.comment
                            const add_result = pywebview.api.add_account(name, student_id, password, comment)
                            add_result.then(function (result) {

                                if (result['success']) {
                                    // 添加成功
                                    layer.alert(result['info'])
                                } else {
                                    // 添加失败
                                    layer.alert(result['info'])
                                }
                            })
                        }
                        layer.alert('登录成功')
                    } else {
                        // 登录失败
                        layer.alert(result['info'])
                    }
                })
                console.log(login_result)

            });
            return false;
        });
    });
</script>
<script>
    layui.use(function () {
        const form = layui.form;
        const layer = layui.layer;
        // checkbox 事件
        form.on('switch(save_account_switch)', function (data) {
            const elem = data.elem; // 获得 checkbox 原始 DOM 对象
            const name_div = document.getElementById('form-div-name');
            const comment_div = document.getElementById('form-div-comment');
            if (elem.checked){
                name_div.style.display = 'block';
                comment_div.style.display = 'block';
                layer.msg('记住账号与密码')
            } else {
                name_div.style.display = 'none';
                comment_div.style.display = 'none';
                layer.msg('直接登录')
            }
        });
        // 通过表单提交事件，演示 checkbox 不同状态下的字段结果

    });
</script>
</body>
</html>